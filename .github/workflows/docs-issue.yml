name: Create documentation ticket

on:
  pull_request_target:
    branches:
      - main
    types:
      - closed

jobs:
  create-docs-ticket:
    runs-on: ubuntu-22.04
    steps:
      - name: Create Issue
        id: create-issue
        if: github.event.pull_request.merged && contains(github.event.pull_request.labels.*.name, 'DocumentationNeeded')
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.ISSUE_PAT }}
          script: |
            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: 'test-private',
              title: context.payload.pull_request.title,
              body: `_This issue was auto-generated_\n\n` +
                `PR: ${context.payload.pull_request.html_url}\n` +
                `Author: ${context.payload.pull_request.user.login}\n\n` +
                '## Original PR Body\n\n' +
                context.payload.pull_request.body,
              labels: ['triage', 'autogenerated']
            });

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `Labels indicate documentation is required. An issue for documentation has been opened at ${issue.data.html_url}`
            })
